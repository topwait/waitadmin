tinymce.PluginManager.add('video', function(editor) {
    // 自定义SVG图标库
    editor.ui.registry.getAll().icons.axupimgs || editor.ui.registry.addIcon('video','<svg t="1665299227334" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="35244" width="24" height="24"><path d="M413.504 666.944l223.488-127.296c20.544-11.776 20.544-45.248 0-56.96l-223.488-127.36c-18.624-10.56-40.448 4.736-40.448 28.48v254.72c0 23.68 21.824 38.976 40.448 28.416z m462.656-537.856H149.312c-45.952 0-83.52 43.136-83.52 96v572.096c0 52.992 37.248 96 83.52 96H876.16c46.016 0 83.52-43.2 83.52-96V225.088c0-53.056-37.248-96-83.52-96zM233.344 797.376c0 17.728-11.968 32.128-28.224 32.128h-55.296c-15.616 0-28.224-13.632-28.224-32.128v-63.04c0-17.728 11.968-32.128 28.224-32.128h55.36c15.552 0 28.16 13.632 28.16 32.128v63.04z m0-254.72c0 17.792-11.968 32.128-28.224 32.128h-55.296c-15.552 0-28.224-13.568-28.224-32.128v-63.04c0-17.728 11.968-32.128 28.224-32.128h55.36c15.552 0 28.16 13.632 28.16 32.128v63.04z m0-254.656c0 17.728-11.968 32.128-28.224 32.128h-55.296c-15.552 0-28.224-13.632-28.224-32.128v-63.04c0-17.792 11.968-32.128 28.224-32.128h55.36c15.552 0 28.16 13.632 28.16 32.128V288z m502.912 541.504H289.28V192.768h446.976v636.736z m167.552-32.128c0 17.728-11.968 32.128-28.16 32.128h-55.36c-15.488 0-28.096-13.632-28.096-32.128v-63.04c0-17.728 11.968-32.128 28.16-32.128h55.36c15.488 0 28.096 13.632 28.096 32.128v63.04z m0-254.72c0 17.792-11.968 32.128-28.16 32.128h-55.36c-15.488 0-28.096-13.632-28.096-32.128v-63.04c0-17.728 11.968-32.128 28.16-32.128h55.36c15.488 0 28.096 13.632 28.096 32.128v63.04z m0-254.656c0 17.728-11.968 32.128-28.16 32.128h-55.36c-15.488 0-28.096-13.632-28.096-32.128v-63.04c0-17.792 11.968-32.128 28.16-32.128h55.36c15.488 0 28.096 13.632 28.096 32.128V288z" p-id="35245" fill="#222f3e"></path></svg>');
	
    // 批量上传处理事件
    var batchUpload = function () {
        return  tinymce.settings.video_upload_callback(function (urls) {
            var html = '';
            urls.forEach(url => {
                url = url.trim().split('?')[0];
                arr = url.split('.');
                ext = arr[arr.length - 1].toLowerCase();

                html += '<video controls="controls" width="300" height="150">';
                html += '<source src="'+ url +'" type="video/'+ ext +'" />';
                html += '</video>'
            });
            editor.insertContent(html);
        })
    };
    
    // 注册工具栏按钮
    editor.ui.registry.addButton('video', {
        icon: 'video',
        tooltip: '视频附件',
        onAction: function () {
            batchUpload();
        }
    });
  
    // 注册菜单项按钮
    editor.ui.registry.addMenuItem('video', {
        icon: 'video',
        text: '视频附件',
        onAction: function() {
            batchUpload();
        }
    });
    
    //插件版权信息注册
    return {
        getMetadata: function () {
            return  {
                name: "Video Accessories Plugin",
                url: "http://www.waiadmin.cn",
            };
        }
    };
});
  
  