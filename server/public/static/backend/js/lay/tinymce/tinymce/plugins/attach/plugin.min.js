tinymce.PluginManager.add('attach', function(editor) {
    // 自定义SVG图标库
    editor.ui.registry.getAll().icons.axupimgs || editor.ui.registry.addIcon('attach','<svg t="1665297208544" class="icon" viewBox="0 0 1040 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="15371" width="24" height="24"><path d="M986.4068 263.666098l-75.878155 0 0 75.877131c0 20.937868-16.997116 37.936007-37.934984 37.936007-20.945031 0-37.942147-16.999163-37.942147-37.936007l0-75.877131L758.774383 263.666098c-20.942985 0-37.936007-16.999163-37.936007-37.942147 0-20.942985 16.993023-37.934984 37.936007-37.934984l75.877131 0 0-75.878155c0-20.942985 16.997116-37.940101 37.942147-37.940101 20.937868 0 37.934984 16.997116 37.934984 37.940101l0 75.878155 75.878155 0c20.942985 0 37.940101 16.991999 37.940101 37.934984C1024.346901 246.667959 1007.349785 263.666098 986.4068 263.666098L986.4068 263.666098zM758.774383 396.447241c0 31.41243-25.491581 56.909128-56.909128 56.909128-31.413454 0-56.904011-25.497721-56.904011-56.909128s25.490557-56.904011 56.904011-56.904011C733.281779 339.54323 758.774383 365.035834 758.774383 396.447241L758.774383 396.447241zM607.019097 263.666098 75.877131 263.666098l0 528.748453c0.076748-0.265036 83.047438-372.255259 225.244021-372.255259 93.66731 0 188.932 287.689235 248.310366 374.648772 0 0 46.549176-188.480722 126.866433-189.69641 79.44233-1.177825 120.417557 187.301873 120.417557 187.301873l37.936007 0L834.651514 567.175647c0-20.942985 16.997116-37.942147 37.942147-37.942147 20.937868 0 37.934984 16.999163 37.934984 37.942147l0 303.509549c0 41.919738-33.989115 75.877131-75.877131 75.877131L75.877131 946.562327c-41.919738 0-75.877131-33.957393-75.877131-75.877131L0 263.666098c0-41.924855 33.957393-75.877131 75.877131-75.877131l531.141966 0c20.942985 0 37.942147 16.991999 37.942147 37.934984C644.961244 246.667959 627.962082 263.666098 607.019097 263.666098L607.019097 263.666098zM607.019097 263.666098" p-id="15372" fill="#222f3e"></path></svg>');
	
    // 批量上传处理事件
    var batchUpload = function () {
        let imageExt = ['jpeg', 'jpg', 'png', 'gif', 'bmp', 'pdf', 'tiff', 'svg', 'avif', 'webp', 'ico'];
        let videoExt = ['mp4', 'mp3', 'avi', 'flv', 'f4v', 'rmvb', 'mov', 'wmv', 'mpeg', '3gp', 'vob', 'asf']
        return  tinymce.settings.attach_upload_callback(function (urls) {
            var html = '';
            urls.forEach(url => {
                url = url.trim().split('?')[0];
                arr = url.split('.');
                ext = arr[arr.length - 1].toLowerCase();

                if (imageExt.includes(ext)) {
                    html += '<img src="'+ url +'" alt="img" />';
                } else if (videoExt.includes(ext)) {
                    html += '<video controls="controls" width="300" height="150">';
                    html += '<source src="'+ url +'" type="video/'+ ext +'" />';
                    html += '</video>'
                } else {
                    html += '<span style="color:red;">'+ url +'</span>';
                }
            });
            editor.insertContent(html);
        })
    };
    
    // 注册工具栏按钮
    editor.ui.registry.addButton('attach', {
        icon: 'attach',
        tooltip: '附件选择',
        onAction: function () {
            batchUpload();
        }
    });
  
    // 注册菜单项按钮
    editor.ui.registry.addMenuItem('attach', {
        icon: 'attach',
        text: '附件选择',
        onAction: function() {
            batchUpload();
        }
    });
    
    //插件版权信息注册
    return {
        getMetadata: function () {
            return  {
                name: "Attachment Selection Plugin",
                url: "http://www.waitadmin.cn",
            };
        }
    };
});
  
  