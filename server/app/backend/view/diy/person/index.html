{extend name="common/layout" /}

{block name="style"}
<style>
    .phone {position: relative; width: 360px; min-width: 360px; height: 615px; color: #333; margin-right: 25px; border: 1px solid #ddd; background-color: #f7f7f7;}
    .phone .bottom {position: absolute; bottom: 0;width: 100%;height: 50px; display: flex; justify-content: space-between; border: 2px solid #4a5dff; box-sizing: border-box; background-color: #ffffff;}
    .phone .bottom .item {display: flex; flex-direction: column; align-items: center; justify-content: center; width: 33.33%;}
    .phone .bottom .item img {width: 22px; height: 22px;}
    .editor {width: 460px; max-width: 460px;}
</style>
{/block}

{block name="body"}
<div class="container">
    <div class="layui-card layui-form">
        <div class="layui-card-body">
            <div style="display: flex;">
                <div class="phone">
                    <div class="phone">
                        <div class="bottom">
                            <div class="item">
                                <img src="http://waitadmin.local/storage/config/tabBar/tab_home.png" alt="icon">
                                <div>首页</div>
                            </div>
                            <div class="item">
                                <img src="http://waitadmin.local/storage/config/tabBar/tab_home.png" alt="icon">
                                <div>资讯</div>
                            </div>
                            <div class="item">
                                <img src="http://waitadmin.local/storage/config/tabBar/tab_home.png" alt="icon">
                                <div>我的</div>
                            </div>
                        </div>
                    </div>
                </div>
                <div>
                    <!-- 表格栏-->
                    <table id="wait-table-list" lay-filter="wait-table-list"></table>
                    <!-- 工具栏 -->
                    <script type="text/html" id="toolbar">
                        <div class="layui-btn-container">
                            <button class="layui-btn layui-btn-sm layui-btn-default" lay-event="add">新增功能</button>
                        </div>
                    </script>
                    <!-- 图标 -->
                    <script type="text/html" id="table-image">
                        <img src="{{d.image}}" alt="img" style="width:30px; height:30px;">
                    </script>
                    <!-- 类型 -->
                    <script type="text/html" id="table-type">
                        {{# if (d.link_type == 1) { }}
                            <button class="layui-btn layui-btn-xs layui-btn-warm">固定模块</button>
                        {{# } else { }}
                            <button class="layui-btn layui-btn-xs layui-btn-primary">自定链接</button>
                        {{# } }}
                    </script>
                    <!-- 状态 -->
                    <script type="text/html" id="table-status">
                        <input type="checkbox" name="is_like" lay-filter="switch-status"
                               data-id={{d.id}} lay-skin="switch" lay-text="是|否"
                               {{# if(d.is_show==1){ }} checked {{# } }}>
                    </script>
                    <!-- 操作 -->
                    <script type="text/html" id="table-operate">
                        <button type="button" class="layui-btn layui-btn-xs layui-btn-default" lay-event="edit">
                            <i class="layui-icon icon-edit"></i>
                        </button>
                        <button type="button" class="layui-btn layui-btn-xs layui-btn-danger" lay-event="del">
                            <i class="layui-icon icon-del"></i>
                        </button>
                    </script>
                </div>
            </div>
        </div>
    </div>
</div>
{/block}

{block name="js"}
<script>
    layui.use(function() {

        // 渲染表格
        let table = waitUtil.table({
            elem: '#wait-table-list'
            ,url: "{:route('diy.person/index')}"
            ,cols: [[
                {field:'id', title:'ID', width:60, align:'center'},
                {field:'name', title:'功能名称', width:120},
                {field:'image', title:'功能图标', width:90, align:'center', templet:'#table-image'},
                {field:'link_type', title:'链接类型', width:100, align:'center', templet:'#table-type'},
                {field:'sort', title:'排序', width:80, align:'center'},
                {field:'status', title:'是否显示', width:100, align:'center', templet:'#table-status'},
                {fixed:'right', title:'操作', toolbar:'#table-operate', width:90, align:'center'},
            ]]
        });

        // 逻辑事件
        waitUtil.event({
            add: function () {
                waitUtil.popup({
                    title: '新增',
                    url: '{:route("diy.person/add")}',
                    area: ['500px', '530px'],
                    success: function (layero, index) {
                        layero.layui.form.on('submit(addForm)', function(data){
                            waitUtil.locking(this);
                            if (!data.field.image) {
                                return layer.msg('请选择图标');
                            }
                            waitUtil.ajax({
                                url: '{:route("diy.person/add")}',
                                type: 'POST',
                                data: data.field
                            }).then(() => {
                                waitUtil.unlock(this);
                                table.reload({where: [], page: {curr: 1}});
                                layer.close(index);
                            });
                        });
                    }
                });
            },
            edit: function (obj) {
                waitUtil.popup({
                    title: '编辑',
                    url: '{:route("diy.person/edit")}?id='+obj.data.id,
                    area: ['500px', '530px'],
                    success: function (layero, index) {
                        layero.layui.form.on('submit(addForm)', function(data){
                            waitUtil.locking(this);
                            if (!data.field.image) {
                                return layer.msg('请选择图标');
                            }
                            data.field['id'] = obj.data.id;
                            waitUtil.ajax({
                                url: '{:route("diy.person/edit")}',
                                type: 'POST',
                                data: data.field
                            }).then(() => {
                                waitUtil.unlock(this);
                                table.reload();
                                layer.close(index);
                            });
                        });
                    }
                });
            },
            del: function (obj) {
                layer.confirm('确定要删除此项数据吗？', function(index) {
                    waitUtil.ajax({
                        url: '{:route("diy.person/del")}',
                        type: 'POST',
                        data: {'id': obj.data.id}
                    }).then(() => {
                        table.reload();
                        layer.close(index)
                    });
                });
            },
            change: function (obj) {
                let id = obj.elem.attributes['data-id'].nodeValue;
                waitUtil.ajax({
                    url: '{:route("diy.person/status")}',
                    type: 'POST',
                    data: {'id': id}
                }).then(() => {
                    table.reload();
                });
            }
        });
    });
</script>
{/block}